<!-- <!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head> -->

<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<header th:replace="include/header"></header>
<link href="https://fonts.googleapis.com/css?family=Black+Han+Sans|Do+Hyeon|Jua|Nanum+Gothic|Sunflower:300" rel="stylesheet">

<body>
	<section class="bg-cencer bg-cover"
		style="background: url(/img/mainphoto/boardphoto.jpg);">
		<div class="dark-overlay">
			<div class="overlay-content py-5 index-forward">
				<div class="container py-5 mt-5">
					<div class="row py-5 text-white text-center">
						<div class="col-lg-7 mx-auto">
							<h1 class="text-xl">리뷰게시판</h1>
							<p class="lead">매월 15일, 베스트 리뷰 두 분을 선정합니다</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="py-5">
		<div class="container">
		<div style="float: right;">
			<button class="btn btn-primary" onclick="location.href='/review'">목록</button>
			<button type="button" class="adminreco btn btn-primary">추천하기</button>
				<a class="btn btn-primary"
					th:href="@{/review/reviewboardupdate/{bno} (bno=${reviewboarddetail.bno})}">수정</a>
				<a class="btn btn-primary"
					th:href="@{/review/reviewboarddelete/{bno} (bno=${reviewboarddetail.bno})}">삭제</a>
			</div>
			<div class="row">

				<div class="reco col-md-4">
					<h2>게시글 상세</h2>
				</div>
					
					<div class="reco col-md-2">
					<br><br><br>
					<div style="text-align: right">
					<br>
					<p style="font-family: 'Nanum Gothic', sans-serif;">번호</p>
					<br>
					<p style="font-family: 'Nanum Gothic', sans-serif;">제목</p>
					<br>
					<p style="font-family: 'Nanum Gothic', sans-serif;">유형</p>
					<br>
					<p style="font-family: 'Nanum Gothic', sans-serif;">내용</p>
					<br>
					<p style="font-family: 'Nanum Gothic', sans-serif;">작성자명</p>
					<br>
					<p style="font-family: 'Nanum Gothic', sans-serif;">파일명</p>
				</div>
				</div>

				<div class="reco col-md-4">
				<br><br><br><br>
					<div class="form-group h5">
						<!-- <label>글번호</label> -->
						<p th:text="${reviewboarddetail.bno}" ></p>
					</div>
					<br>
					<div class="form-group h5">
						<!-- <label>게시글제목</label> -->
						<p th:text="${reviewboarddetail.title}"></p>
					</div>
					<br>
					<div class="form-group h5">
						<!-- <label>게임유형</label> -->
						<p th:text="${reviewboarddetail.type}"></p>
					</div>
					<br>
					<div class="form-group h5">
						<!-- <label>게시글 내용</label> -->
						<p th:text="${reviewboarddetail.memo}"></p>
					</div>
					<br>
					<div class="form-group h5">
						<!-- <label>작성자 이름</label> -->
						<!-- 				<p sec:authentication="principal.username"></p> -->
						<p th:text="${reviewboarddetail.writer}"></p>
					</div>
					<br>
					<div class="form-group h5">
						<!-- <label>파일명</label> -->
						<a th:href="@{/review/reviewboarddetail/{bno} (bno=${reviewboarddetail.bno})/{filename} (filename=${reviewboarddetail.filename})} "
							th:text="${reviewboarddetail.filename}">file</a>
					</div>
				</div>
		</div>
			
		<br>

		<div th:each="review:${reviewboarddetail}">
			<input id="bno" type="hidden" th:value=${review.bno}> <input
				id="writer" type="hidden" th:value=${review.Writer}>

			<!-- 			<div class="reco"> -->
			<!-- 				추천수 -->
			<!-- 				<button type="button" class="btn btn-primary"> -->
			<!-- 				일반 추천하기 -->
			<!-- 				</button> -->
			<!-- 			</div> -->

			<!-- <div class="adminreco">
				추천수
				
			</div> -->
		</div>
		
		<div>
		<!--  댓글  -->
		<br><br> <!-- <label for="content">댓글</label> -->
		<form name="commentInsertForm" id="commentInsertForm">
			<div class="input-group">
				<input type="hidden" name="bno" id="bno" th:value="${reviewboarddetail.bno}" /> 
					<input type="text" class="form-control" id="content" name="content" placeholder="댓글을 입력하세요."> 
					<span class="input-group-btn">
					<button class="btn btn-primary mr-1" type="button" id="commentInsertBtn"
						name="commentInsertBtn">등록</button>
				</span>
			</div>
		</form>
		</div>
		<div class="commentList"></div>


<!-- 		<button class="btn btn-primary" onclick="location.href='/review'">목록</button>
 -->	</div>
	</section>
</body>

<style>
	.commentgrid{
		width:20%;
		display: grid;
		grid-template-columns: 1fr 1fr;
		grid-gap: 10px;
	}
</style>

<script>
	// $('.reco button').click(
	// 		function() {
	// 			$(location).attr(

	// 					'href',
	// 					'http://localhost:4007/review/recommendProc/'
	// 							+ $('#bno').val());
	// 		});
	$('.adminreco button').click(
			function() {
				$(location).attr(
						'href',
						'http://localhost:4007/review/adminrecommendProc/'
								+ $('#bno').val());
			});

	// $(document).ready(function(){
	//     commentList(); //페이지 로딩시 댓글 목록 출력 

	//     //댓글 등록
	//     $('#commentInsertBtn').click(function(){

	//     	var insertData = $('#commentInsertForm').serialize();
	//     	console.log(insertData);
	//         $.ajax({
	//             url : '/comment/insert',
	//             type : 'post',
	//             data : insertData,
	//             success : function(data){
	//                 if(data == 1) {
	//                     commentList(); //댓글 작성 후 댓글 목록 reload
	//                     $('[name=content]').val('');
	//                 }
	//             }
	//         })
	//     });
	//     /* function commentInsert(){
	//     	var insertData = ('#commentInsertForm').serialize();
	//     	console.log(insertData);
	//         $.ajax({
	//             url : '/comment/insert',
	//             type : 'post',
	//             data : insertData,
	//             success : function(data){
	//                 if(data == 1) {
	//                     commentList(); //댓글 작성 후 댓글 목록 reload
	//                     $('[name=content]').val('');
	//                 }
	//             }
	//         });
	//     } */

	// });

	//댓글 목록 
	function commentList() {
		var data = $('#commentInsertForm').serialize();
		$
				.ajax({
					url : '/comment/list',
					type : 'get',
					data : {
						'bno' : bno
					},
					success : function(data) {
						var a = '';
						$
								.each(
										data,
										function(key, value) {
											a += '<div class="commentArea" style="border-bottom:1px solid darkgray; margin-bottom: 15px;">';
											a += '<br><div class="commentInfo'+value.cno+' commentgrid">'
										
													/* + '댓글번호 : '
													+ value.cno */
													+ '작성자 : '
													+ value.writer;
											a += '<div><a class="btn btn-outline-dark btn-sm" style="font-size:8px; border-top-left-radius: 5px; border-bottom-left-radius: 5px; " onclick="commentUpdate('
													+ value.cno
													+ ',\''
													+ value.content
													+ '\');"> 수정 </a>';
											a += '<a class="btn btn-outline-dark btn-sm" style="font-size:8px; border-top-right-radius: 5px; border-bottom-right-radius: 5px;" onclick="commentDelete('
													+ value.cno
													+ ');"> 삭제 </a></div></div>';
											a += '<div class="commentContent'+value.cno+'"> <p> 내용 : '
													+ value.content + '</p>';
											a += '</div></div>';
										});

						$(".commentList").html(a);
					}
				/* error:function(request,status,error){
				    alert("code = "+ request.status + " message = " + request.responseText + " error = " + error); // 실패 시 처리
				   } */
				});
	}

	//댓글 수정 - 댓글 내용 출력을 input 폼으로 변경 
	function commentUpdate(cno, content) {

		var a = '';

		a += '<div class="input-group">';
		a += '<input type="text" class="form-control" name="content_'+cno+'" value="'+content+'"/>';
		a += '<span class="input-group-btn"><button class="btn btn-default" type="button" onclick="commentUpdateProc('
				+ cno + ');">수정</button> </span>';
		a += '</div>';

		$('.commentContent' + cno).html(a);

	}

	//댓글 수정
	function commentUpdateProc(cno) {

		var updateContent = $('[name=content_' + cno + ']').val();

		$.ajax({
			url : '/comment/update',
			type : 'post',
			data : {
				'content' : updateContent,
				'cno' : cno
			},
			success : function(data) {
				if (data == 1)
					commentList(bno); //댓글 수정후 목록 출력 
			}
		});
	}

	//댓글 삭제 
	function commentDelete(cno) {
		$.ajax({
			url : '/comment/delete/' + cno,
			type : 'post',
			success : function(data) {
				if (data == 1)
					commentList(bno); //댓글 삭제후 목록 출력 
			}
		});
	}

	var bno = $('#bno').val(); //게시글 번호

	/* $('#commentInsertBtn').click(function(){ //댓글 등록 버튼 클릭시 
	 var insertData = $('#commentInsertForm').serialize(); //commentInsertForm의 내용을 가져옴
	 commentInsert(insertData); //Insert 함수호출(아래)
	 }); */

	$(document).ready(function() {
		commentList(); //페이지 로딩시 댓글 목록 출력 

		//댓글 등록
		$('#commentInsertBtn').click(function() {

			var insertData = $('#commentInsertForm').serialize();
			console.log(insertData);
			$.ajax({
				url : '/comment/insert',
				type : 'post',
				data : insertData,
				success : function(data) {
					if (data == 1) {
						commentList(); //댓글 작성 후 댓글 목록 reload
						$('[name=content]').val('');
					}
				}
			})
		});
		/* function commentInsert(){
			var insertData = ('#commentInsertForm').serialize();
			console.log(insertData);
		    $.ajax({
		        url : '/comment/insert',
		        type : 'post',
		        data : insertData,
		        success : function(data){
		            if(data == 1) {
		                commentList(); //댓글 작성 후 댓글 목록 reload
		                $('[name=content]').val('');
		            }
		        }
		    });
		} */

	});
</script>
</html>